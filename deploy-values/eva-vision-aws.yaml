# values.yaml for AWS EKS Production

# 1. Image Config
image:
  repository: 339713051385.dkr.ecr.ap-northeast-2.amazonaws.com/mellerikat/release/eva-vision
  pullPolicy: Always
  tag: 1.3.0

runtimeClassName: ""
# 2. Replica
replicaCount: 1

# 3. Resources (GPU Setting)
resources:
  limits:
    nvidia.com/gpu: 1  
    memory: "10Gi" 
    cpu: "4"
  requests:
    memory: "8Gi"
    cpu: "2"
    nvidia.com/gpu: 1

service:
  type: ClusterIP
  port: 8000

serviceAccount:
  create: true
  name: ""
  annotations: {}

# 4. Node Affinity 
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: eks.amazonaws.com/nodegroup
          operator: In
          values:
          - ng-an2-eva-app

nodeSelector: {}
tolerations: []

# 5. Application Config (TorchServe)
appConfig:
  # JVM Args
  vmargs: "-Dlog4j.configurationFile=eva_ts/log4j2.xml"

  # Network
  inference_address: "http://0.0.0.0:8080"
  management_address: "http://0.0.0.0:8081"
  metrics_address: "http://0.0.0.0:8082"
  grpc_inference_port: 7070
  grpc_management_port: 7071

  # Metrics / Flags
  enable_envvars_config: true
  enable_metrics_api: false
  metrics_format: "prometheus"
  metrics_interval: 600
  install_py_dep_per_model: true
  default_workers_per_model: 1
  disable_token_authorization: true

  # Models to Load
  load_models: "Owl-v2.mar,ig.mar,OmDet.mar,LLMDet.mar,MMGDino.mar,RT-DETRV2.mar"

  models:
    Owl-v2:
      "1.0":
        defaultVersion: true
        marName: "Owl-v2.mar"
        minWorkers: 1
        maxWorkers: 1
        batchSize: 1
        maxBatchDelay: 150
    OmDet:
      "1.0":
        defaultVersion: true
        marName: "OmDet.mar"
        minWorkers: 2
        maxWorkers: 2
        batchSize: 1
    RT-DETRV2:
      "1.0":
        defaultVersion: true
        marName: "RT-DETRV2.mar"
        minWorkers: 1
        maxWorkers: 1
        batchSize: 8
        maxBatchDelay: 30
    LLMDet:
      "1.0":
        defaultVersion: true
        marName: "LLMDet.mar"
        minWorkers: 1
        maxWorkers: 1
        batchSize: 1
        maxBatchDelay: 150
    MMGDino:
      "1.0":
        defaultVersion: true
        marName: "MMGDino.mar"
        minWorkers: 2
        maxWorkers: 2
        batchSize: 1
        maxBatchDelay: 150

# 6. Persistence (Log Storage)
persistence:
  enabled: true
  storageClass: "eva-agent-sc-bs"  
  size: 20Gi                     
  accessModes:
    - ReadWriteOnce

  # Pod mount
  mountPath: "/app/logs"
  subPath: ""

  # TorchServe internal paths
  modelStore: "model-store"
  tmpDir: "tmp"
  logLocation: "logs"



