# values.yaml

# 이미지 설정
image:
  repository: 339713051385.dkr.ecr.ap-northeast-2.amazonaws.com/ecr-repo-an2-iac-prod/eva/ai-solutions/eva-vision/inference/eva-vision
  pullPolicy: IfNotPresent
  tag: v2

# Replica 수
replicaCount: 1

# 리소스 설정
resources:
  limits:
    nvidia.com/gpu: 1
    memory: "8Gi"
    cpu: "4"
  requests:
    memory: "4Gi"
    cpu: "2"

# 서비스 설정
service:
  type: ClusterIP
  port: 8000

# ServiceAccount 설정
serviceAccount:
  create: true
  name: ""        # 비워두면 <release>-sa 로 생성
  annotations: {}
  automountServiceAccountToken: false

# Pod 메타데이터
podAnnotations: {}
podLabels: {}

# 스케줄링 관련
nodeSelector: {}
tolerations: []
affinity: {}

# TorchServe / App 설정
appConfig:
  # JVM Args
  vmargs: "-Dlog4j.configurationFile=eva_ts/log4j2.xml"

  # Network
  inference_address: "http://0.0.0.0:8080"
  management_address: "http://0.0.0.0:8081"
  metrics_address: "http://0.0.0.0:8082"
  grpc_inference_port: 7070
  grpc_management_port: 7071

  # Metrics / Flags
  enable_envvars_config: true
  enable_metrics_api: false
  metrics_format: "prometheus"
  metrics_interval: 600
  install_py_dep_per_model: true
  default_workers_per_model: 1
  disable_token_authorization: true

  # Models 요약 정보 (config.properties 의 load_models 에 그대로 사용)
  load_models: "Owl-v2.mar,ig.mar,OmDet.mar,VitPose.mar"

  # Models 상세 설정 (config.properties 의 models JSON 으로 변환됨)
  models:
    Owl-v2:
      "1.0":
        defaultVersion: true
        marName: "Owl-v2.mar"
        minWorkers: 1
        maxWorkers: 1
        batchSize: 1
        maxBatchDelay: 150
    OmDet:
      "1.0":
        defaultVersion: true
        marName: "OmDet.mar"
        minWorkers: 1
        maxWorkers: 1
        batchSize: 1
        maxBatchDelay: 150
    LLMDet:
      "1.0":
        defaultVersion: true
        marName: "LLMDet.mar"
        minWorkers: 1
        maxWorkers: 1
        batchSize: 1
        maxBatchDelay: 150
    VitPose:
      "1.0":
        defaultVersion: true
        marName: "VitPose.mar"
        minWorkers: 1
        maxWorkers: 2
        batchSize: 1
        maxBatchDelay: 100

# 로깅/저장소 설정 (로그가 날아가지 않도록 PVC 사용)
persistence:
  enabled: false

  # 기존 PVC 재사용 시 이름 지정 (우선순위 가장 높음)
  existingClaim: ""

  # 새 PVC 생성 시 설정 (existingClaim 비어있을 때만 사용)
  storageClass: ""        # "" 이면 default StorageClass 사용
  size: 20Gi
  accessModes:
    - ReadWriteOnce

  # Pod 내 마운트 경로
  mountPath: "/app/logs"
  subPath: ""

  # PVC 메타데이터
  annotations: {}
  labels: {}

  # TorchServe config.properties 에 들어가는 경로들
  modelStore: "model-store"  # 컨테이너 내부 경로
  tmpDir: "tmp"
  logLocation: "logs"        # TorchServe 입장에서의 log 디렉터리 (컨테이너 경로 기준)
